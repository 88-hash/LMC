# 第12步（验证码版）：构建手机号+验证码登录体系

## 1. 后端 - 验证码服务 (Verification)
### 目标
实现真实的验证码发送与校验逻辑（控制台模拟短信）。

### 任务
1.  **修改 `UserService` 接口及实现**：
    *   增加 `sendCode(String phone)` 方法：
        *   生成 6 位随机数。
        *   存入全局 `Map<String, String> codeCache`。
        *   `System.out.println` 打印验证码。
    *   修改 `login(String phone, String code)` 方法：
        *   增加验证码校验逻辑：比对 `codeCache`。
        *   校验通过后，执行原有的“注册/登录”逻辑。
        *   返回 JWT Token。
2.  **修改 `UserController`**：
    *   新增 `POST /code` 接口：调用 `userService.sendCode`。
    *   修改 `POST /login` 接口：接收 `code` 参数，调用 `userService.login`。

## 2. 后端 - 全局鉴权 (Security)
### 目标
移除硬编码 `userId=1L`，通过拦截器解析 Token 获取真实用户 ID。

### 任务
1.  **创建 `LoginInterceptor`**：
    *   实现 `HandlerInterceptor`。
    *   拦截请求，从 Header 获取 `Authorization` (Token)。
    *   解析 Token，获取 `userId`。
    *   将 `userId` 存入 `request.setAttribute("userId", ...)`。
    *   如果无 Token 或无效，返回 401 错误。
2.  **配置 `WebMvcConfig`**：
    *   注册 `LoginInterceptor`。
    *   配置拦截路径：`/cart/**`, `/order/**`, `/user/info` 等需要登录的接口。
    *   放行路径：`/user/login`, `/user/code`, `/goods/**`, `/category/**` 等。
3.  **清理 Controller 硬编码**：
    *   修改 `CartController`：移除 `userId = 1L`，改为 `(Long) request.getAttribute("userId")`。
    *   修改 `OrderController`：移除 `userId = 1L`，改为 `(Long) request.getAttribute("userId")`。
    *   修改 `UserController` 的 `getUserInfo`：同样从 request 获取 ID。

## 3. 前端 - 验证码登录页 (Login.vue)
### 目标
实现“获取验证码 -> 倒计时 -> 登录”的完整交互。

### 任务
1.  **重构 UI**：
    *   添加“验证码”输入框和“获取验证码”按钮。
2.  **实现逻辑**：
    *   `sendCode` 方法：调用 `/user/code`，成功后开始 60s 倒计时，按钮禁用。
    *   `handleLogin` 方法：调用 `/user/login`，带上手机号和验证码。
    *   登录成功后，存储 Token 到 `localStorage`，跳转首页。

## 4. 前端 - 个人中心 & 守卫
### 目标
完善用户状态管理，防止未登录访问。

### 任务
1.  **开发 `Profile.vue`**：
    *   展示头像、昵称、手机号。
    *   添加“退出登录”按钮：清除 Token，跳转登录页。
2.  **配置路由守卫 (`router/index.js`)**：
    *   `beforeEach` 钩子：检查 `to.meta.requiresAuth`。
    *   如果未登录（无 Token），强制跳转 `/login`。

请确认执行此计划。