# 🔄 订单状态同步修复计划 (Order Status Sync Fix)

**问题确认**: 用户反馈 B 端核销后，C 端订单列表仍显示“待付款”和“去支付”。
**根本原因**:
1.  **前端未自动刷新**: C 端页面数据是静态加载的，B 端核销改变了数据库状态，但 C 端没有重新请求最新数据。
2.  **后端状态流转**: 需要确认 B 端核销接口是否正确将订单状态从 `2` (待核销) 更新为 `3` (已完成)。
3.  **前端展示逻辑**: `Order.vue` 需要根据状态正确渲染按钮（核销后应显示“去评价”或“已完成”，而非“去支付”）。

## 🛠️ 修复步骤

### 1. 验证后端核销逻辑 (Check Backend)
*   **动作**: 检查 B 端核销接口（通常在 `AdminOrderController` 或类似位置）。
*   **预期**: 核销操作应将订单状态更新为 `3` (已完成)。如果目前只更新了 `status` 但没处理好，需要修正。
*   **补充**: 确保 C 端 `OrderController.list` 查询出的数据包含最新的 `status`。

### 2. 优化 C 端订单列表 (`src/views/Order.vue`)
*   **手动刷新**: 在页面顶部添加一个“刷新”按钮，方便用户手动拉取最新状态。
*   **自动刷新**: 在 `onMounted` 时（已存在）加载数据。如果用户一直在该页面，需要手动刷新或轮询（这里推荐手动刷新 + 交互提示）。
*   **状态映射**: 确保 `getStatusText` 和按钮显示逻辑涵盖所有状态：
    *   `1`: 待付款 -> 显示“去支付”
    *   `2`: 待核销 -> 显示“出示核销码”
    *   `3`: 已完成 -> 显示“去评价”
    *   `4`: 已取消

### 3. 自测场景
1.  **C端下单**: 生成一个新订单 (Status=1)。
2.  **C端支付**: 模拟支付成功 (Status=2)。
3.  **B端核销**: 模拟调用核销接口 (Status -> 3)。
4.  **C端刷新**: 点击刷新按钮，确认订单状态变为“已完成”，按钮变为“去评价”。

---
*请批准执行，我将着重修复状态同步显示的问题。*