# 最终故障排除与修复计划

## 问题诊断
您反馈的截图显示了两个关键问题：
1.  **后端构建失败/运行时异常**：
    *   日志显示 `No MyBatis mapper was found`，导致所有数据库操作失效。
    *   虽然 `LeyiSnackApplication.java` 中确实配置了 `@MapperScan("com.leyi.snack.mapper")`，但日志中的 `WARN` 信息提示 `Failed to search in directory ... target/classes ... NoSuchFileException`。
    *   这表明 Maven 在执行 `spring-boot:run` 时，**类文件编译不完整**或**被意外清理**。这通常发生在 `clean` 和 `run` 命令合并执行时，尤其是在 Windows 文件系统上可能存在文件锁或时序竞争。

2.  **前端表现异常**：
    *   **管理端 404**：因为后端 Mapper 没加载成功，Spring 容器启动不完整或 Controller 方法因依赖注入失败而未注册，导致接口 404。
    *   **客户端停留在首页**：这极有可能是因为您的浏览器中残留了旧的 `token`。我们的路由守卫逻辑是 `if (!token) next('/login')`，如果本地有（哪怕是无效的）token，就会放行进入首页。进入首页后，API 请求失败（因为后端挂了），导致页面空白。

## 修复方案

### 1. 彻底重构后端启动逻辑 (`start_system.bat`)
为了彻底解决 Maven 编译时序问题，我们将启动过程拆分为**两个严格串行**的步骤：
*   **第一步**：执行 `mvn clean compile`。专门负责清理和编译，确保 `target/classes` 下生成了完整的 `.class` 文件和 Mapper XML 文件。
*   **第二步**：执行 `mvn spring-boot:run`。在已有编译产物的基础上启动服务。

这样可以 100% 避免“一边运行一边找类文件却找不到”的尴尬情况。

### 2. 增强客户端容错逻辑 (可选建议)
虽然只要后端修好，前端问题自然解决。但为了保险，建议您在启动成功后，手动**清除浏览器缓存**（或在浏览器控制台 Application -> Local Storage 中删除 token），以触发强制登录跳转。

## 执行步骤
1.  **修改脚本**：我将把 `start_system.bat` 中的后端启动命令改为分步执行模式。
2.  **清理环境**：请您务必关闭所有现有的黑色命令行窗口。
3.  **最终验证**：再次运行脚本。

---
**请确认**：是否立即执行脚本修改？
