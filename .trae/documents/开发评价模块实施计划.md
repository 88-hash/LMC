# 📅 开发计划：评价模块 (Step 15)

本计划旨在实现商品评价的全流程功能，包括后端服务构建和前后端交互实现。严格遵循“多巴胺糖果风”UI 设计和“数据库锁定”原则。

## 1. 后端开发 (Spring Boot)
### 1.1 实体与数据访问层
- **创建实体类**: `Comment.java`
    - 映射 `comment` 表，包含 `id`, `orderItemId`, `userPhone`, `rating`, `content`, `createdAt`。
- **创建 Mapper**: `CommentMapper.java`
    - `save(Comment comment)`: 插入评价。
    - `findByGoodsId(Long goodsId)`: 根据商品ID查询评价列表（用于商品页/管理页）。
    - `findByUserPhone(String userPhone)`: 根据用户手机号查询评价（用于个人中心）。
    - `countByOrderItemId(Long orderItemId)`: 检查是否已评价（防重）。

### 1.2 业务逻辑与接口层
- **创建服务类**: `CommentService.java`
    - `addComment(CommentRequest request)`:
        - 校验订单状态是否为“已完成” (`status == 1`)。
        - 校验是否重复评价。
        - 插入数据。
- **创建控制器**: `CommentController.java`
    - `POST /api/comment/add`: 提交评价。
    - `GET /api/comment/list/goods`: 获取商品评价。
    - `GET /api/comment/list/user`: 获取我的评价。

## 2. 前端 C 端开发 (Vue3)
### 2.1 订单列表页优化
- **文件**: `frontend/src/views/Order.vue`
- **修改**: 在订单卡片底部，针对 `status === 1` 的订单添加“去评价”按钮（高亮样式）。
- **交互**: 点击跳转 `/comment/add/:orderId`。

### 2.2 评价提交页 (新页面)
- **文件**: `frontend/src/views/CommentAdd.vue`
- **UI**: 背景色 `#f7f1e3`，多巴胺配色。
- **功能**:
    - 加载订单详情。
    - 遍历 `orderItems`，为每个商品提供 `el-rate` 和 `el-input`。
    - 提交评价逻辑。

### 2.3 个人中心 - 我的评价 (新页面)
- **文件**: `frontend/src/views/Profile.vue`
    - 添加“我的评价”菜单项。
- **文件**: `frontend/src/views/MyComments.vue`
    - 展示当前用户的所有历史评价。

## 3. 前端 B 端开发 (Vue3 Admin)
### 3.1 商品管理页评价展示
- **文件**: `frontend/src/views/admin/Goods.vue`
- **修改**:
    - 表格操作列增加“查看评价”按钮。
    - 添加 `el-drawer` 组件。
    - 实现调用 `/api/comment/list/goods` 并渲染评价列表（含手机号脱敏）。

## 4. 验证与收尾
- **重启服务**: 重启 Spring Boot 后端。
- **功能验证**:
    1. 用户下单并完成订单。
    2. 用户提交评价，检查防重逻辑。
    3. 用户在“我的评价”查看。
    4. 管理员在商品管理页查看评价。
- **代码清理**: 移除未使用的导入和临时代码。
