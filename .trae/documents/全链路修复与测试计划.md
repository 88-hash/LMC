# 🛒 全链路修复与全系统联调计划 (End-to-End System Fix Plan)

**用户指示**: 必须确保 **C端下单 -> B端同步** 的全流程畅通无阻，不仅是C端闭环，还要验证B端的数据一致性。

## 🎯 核心目标
1.  **C端修复**: 补全购物车勾选、支付回调、核销码展示功能。
2.  **B端验证**: 确保 C 端产生的订单能实时同步到 B 端，且状态流转正确（待付款 -> 待使用 -> 已完成）。
3.  **全流程自测**: 模拟真实业务场景，从 C 端下单到 B 端接单/查看。

## 🛠️ 执行步骤

### Phase 1: C端功能补全 (Frontend Fixes)

#### 1. 购物车增强 (`src/views/Cart.vue`)
*   **增加勾选交互**: 引入复选框，确保用户明确知道自己结算了哪些商品。
*   **状态同步**: 勾选状态变化时，实时计算合计金额。

#### 2. 支付逻辑闭环 (`src/views/Cashier.vue`)
*   **接口调用**: 点击支付时，务必调用后端 `/order/pay` 接口，触发数据库状态更新（`status` 变为 `2` 待使用）。
*   **路由跳转**: 支付成功后引导至订单列表，自动选中“待使用”Tab。

#### 3. 核销功能重构 (`src/views/Order.vue`)
*   **依赖安装**: `npm install qrcode.vue` (用于生成二维码)。
*   **核销弹窗**: 在订单列表项增加“核销码”按钮，点击弹出 **二维码 + 12位数字码**。

### Phase 2: B端数据验证 (Backend & Admin Verification)

#### 1. 验证订单同步
*   **逻辑检查**: 确认 `OrderController.create` 和 `pay` 接口是否正确写入 `orders` 表。
*   **B端视角**: 虽然我不直接操作 B 端前端代码（假设它已存在或由您管理），但我会通过 **后端日志** 和 **数据库查询** 来模拟 B 端查询，确保：
    *   新订单能被 `select * from orders` 查到。
    *   支付后的订单状态准确变为 `2` (待核销)。

### Phase 3: 全流程自测脚本 (Self-Test Scenario)

我将按顺序执行以下操作，并向您汇报每一步的结果：
1.  **C端加购**: 在 `Home.vue` 添加商品 -> **检查数据库 `cart` 表**。
2.  **C端下单**: 在 `Cart.vue` 结算 -> **检查数据库 `orders` 表生成记录 (status=1)**。
3.  **C端支付**: 在 `Cashier.vue` 支付 -> **检查数据库 `orders` 表状态变更 (status=2)**。
4.  **核销展示**: 在 `Order.vue` 打开核销码 -> **截图确认二维码显示**。
5.  **B端模拟**: 运行 SQL 查询当日订单 -> **验证数据完全一致**。

---
*请批准执行，我将按此严格流程进行修复和验证，确保系统无死角。*